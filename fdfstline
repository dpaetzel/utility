#!/usr/bin/env fish
#
# Go over a file set generated by `fd` and only look at the very first line in
# each file for whether it matches the given `awk` pattern.
#
# First argument is the pattern to look for.
#
# All other arguments are passed through to `fd` to build the file list to
# search.
#
# I.e. call this like this:
#
# ```
# ./findfirstlines ";;; neuron" '\.txt' .
# ```
#
# and consider to redirect output:
#
# ```
# ./findfirstlines neuron-mode.el '\.txt' . | tee ../neuron-mode.el.log
# ```


set pattern $argv[1]


fd $argv[2..-1] | parallel -j8 --bar "awk \"
    { if (NR > 1) nextfile }
    /$pattern/ { print FILENAME }
    \" {}"
